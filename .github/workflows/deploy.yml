name: deploy

on:
  push: # master(or main) branchì— push event ë°œìƒí–ˆì„ ë•Œ, deploy workflow ì‹¤í–‰ 
    branches:
      - master
      - main
  pull_request: # master(or main) branchì— pull_request event ë°œìƒí–ˆì„ ë•Œ, deploy workflow ì‹¤í–‰  
    branches:
      - master
      - main
  workflow_dispatch: # workflow_dispatch event ë°œìƒí–ˆì„ ë•Œ, deploy workflow ì‹¤í–‰

permissions: # write ê¶Œí•œ ë¶€ì—¬ 
  contents: write

jobs: 
  deploy: # deploy job ì •ì˜ 
    runs-on: ubuntu-latest # ubuntu osì—ì„œ ì‹¤í–‰ 
    steps:
    - name: Checkout ğŸ›ï¸ # checkout step : action/checout@v3 ì‹¤í–‰
      uses: actions/checkout@v3 
    - name: Setup Ruby # Setup ruby step : ruby/setup-ruby@v1 ì‹¤í–‰ 
      uses: ruby/setup-ruby@v1
      with: # action ì‹¤í–‰ ì‹œ, ì¡°ê±´ ì„¤ì • 
        ruby-version: '3.2.2' # ruby ë²„ì „ ì§€ì •
        bundler-cache: true 
    - name: Update _config.yml âš™ï¸ # Update _config.yml step : fjogeleit/yaml-update-action@v0.13.1 ì‹¤í–‰ 
      uses: fjogeleit/yaml-update-action@v0.13.1
      with: # action ì‹¤í–‰ ì‹œ, ì¡°ê±´ ì„¤ì • 
        commitChange: false # ì»¤ë°‹í•˜ì§€ ì•ŠìŒ
        valueFile: '_config.yml' #ì—…ë°ì´íŠ¸í•  íŒŒì¼
        propertyPath: 'giscus.repo' #ì´ property ì—…ë°ì´íŠ¸
        value: ${{ github.repository }} # í˜„ì¬ repository ì‚¬ìš©
    - name: Install and Build ğŸ”§ # Install and Build step : í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ í›„ í”„ë¡œì íŠ¸ ë¹Œë“œ
      run: |
        pip3 install --upgrade jupyter 
        npm install -g mermaid.cli
        npm install -g purgecss
        export JEKYLL_ENV=production
        bundle exec jekyll build --lsi
        purgecss -c purgecss.config.js
    - name: Deploy ğŸš€ # deploy step : JamesIves/github-pages-deploy-action@v4 ì‹¤í–‰ / eventê°€ pull_requestê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì‹¤í–‰
      if: github.event_name != 'pull_request' 
      uses: JamesIves/github-pages-deploy-action@v4
      with: # _site í´ë” ë°°í¬ 
        folder: _site

